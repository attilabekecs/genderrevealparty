<!DOCTYPE html>
<html lang="hu">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mire nem lesz idej√ºk a sz√ºl≈ëknek?</title>
<link rel="icon" href="data:image/svg+xml,
<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'>
  <text y='.9em' font-size='90'>üë∂</text>
</svg>">


<style>
* { box-sizing: border-box; }

body {
    margin: 0;
    font-family: "Segoe UI", sans-serif;
    background: linear-gradient(135deg, #ffe4ef, #e4f0ff);
    min-height: 100vh;

    display: flex;
    justify-content: center; /* v√≠zszint */
    align-items: center;     /* f√ºgg≈ëleges */
    padding: 30px;
}


.container {
    width: 100%;
    max-width: 900px;
    min-height: 75vh;
    gap: 10px;

    background: white;
    border-radius: 32px;
    padding: 50px 40px;

    box-shadow: 0 25px 60px rgba(0,0,0,0.18);

    display: flex;
    flex-direction: column;
    justify-content: center;
}


h1, p {
    text-align: center;
    margin-top: 0;
}

/* K√ÅRTY√ÅK */
.cards {
    margin-top: 50px;
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
    gap: 24px;
}

.card {
    background: linear-gradient(135deg, #ffd6e8, #d6e8ff);
    border-radius: 28px;
    padding: 26px 20px;
    text-align: center;
    cursor: pointer;
    box-shadow: 0 8px 22px rgba(0,0,0,0.18);
    transition: transform 0.2s, box-shadow 0.2s;
}

.card:hover {
    transform: translateY(-4px);
    box-shadow: 0 12px 28px rgba(0,0,0,0.22);
}

.emoji {
    font-size: 34px;
    margin-bottom: 10px;
}

.label {
    font-weight: 600;
    margin-bottom: 8px;
}

.result {
    font-size: 14px;
    color: #444;
}

@media (max-width: 600px) {

  .container {
    padding: 30px 20px;
    border-radius: 24px;
  }

  h1 {
    font-size: 22px;
  }

  p {
    font-size: 15px;
  }

  /* üîë 2 csempe egym√°s mellett */
  .cards {
    grid-template-columns: repeat(2, 1fr);
    gap: 16px;
    margin-top: 30px;
  }

  .card {
    padding: 20px 14px;
    border-radius: 22px;
  }

  .emoji {
    font-size: 28px;
  }

  .label {
    font-size: 14px;
  }

  .result {
    font-size: 13px;
  }
  .card:active {
    transform: scale(0.97);
  }
}
.card.selected {
  background: linear-gradient(135deg, #ff9fc5, #9fc5ff);
  box-shadow: 0 12px 30px rgba(0,0,0,0.28);
  transform: scale(1.03);
}
/* ===== MODAL ===== */
.modal {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.35);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 9999;
}

.modal.hidden {
  display: none;
}

.modal-content {
  background: white;
  padding: 30px 40px;
  border-radius: 24px;
  text-align: center;
  box-shadow: 0 20px 50px rgba(0,0,0,0.3);
}

.modal-text {
  margin-top: 15px;
  font-size: 16px;
  font-weight: 600;
  color: #444;
}

/* ===== SPINNER ===== */
.spinner {
  width: 46px;
  height: 46px;
  border: 5px solid #eee;
  border-top: 5px solid #ff9fc5;
  border-radius: 50%;
  animation: spin 1s linear infinite;
  margin: 0 auto;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}
.next-btn {
  margin-top: auto;
  align-self: center;
  padding: 14px 36px;
  border-radius: 999px;
  border: none;
  font-size: 16px;
  font-weight: 600;
  cursor: pointer;

  background: linear-gradient(135deg, #ff9fc5, #9fc5ff);
  color: #333;

  box-shadow: 0 10px 25px rgba(0,0,0,0.2);
  transition: transform 0.2s, box-shadow 0.2s;
}

.next-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 14px 32px rgba(0,0,0,0.25);
}

.next-btn:active {
  transform: scale(0.96);
}


</style>
<script src="./config.js"></script>
</head>

<body>

<div class="container">
    <h1>üòÇ Mire nem lesz idej√ºk a sz√ºl≈ëknek?</h1>
    <p>Kattints arra, ami szerinted biztosan h√°tt√©rbe szorul!</p>
<div id="loading" style="
  text-align:center;
  font-size:16px;
  color:#777;
  margin-top:30px;
">
  ‚è≥ Szavazatok bet√∂lt√©se‚Ä¶
</div>
<div id="status" style="
  text-align:center;
  font-size:15px;
  color:#555;
  margin-top:15px;
  display:none;
">
</div>
<div id="modal" class="modal hidden">
  <div class="modal-content">
    <div class="spinner"></div>
    <div class="modal-text">
      ‚è≥ Feldolgozzuk a szavazatod‚Ä¶
    </div>
  </div>
</div>



    <div class="cards" id="cards"></div>
  <button id="nextBtn" class="next-btn">
  ‚û°Ô∏è Tov√°bb
</button>

</div>

<script>
const modalEl = document.getElementById("modal");

function showModal(text = "‚è≥ Feldolgozzuk a szavazatod‚Ä¶") {
  modalEl.querySelector(".modal-text").innerText = text;
  modalEl.classList.remove("hidden");
}

function hideModal() {
  modalEl.classList.add("hidden");
}


const statusEl = document.getElementById("status");
const cardsContainer = document.getElementById("cards");

function showStatus(text) {
  statusEl.innerText = text;
  statusEl.style.display = "block";
}

function hideStatus() {
  statusEl.style.display = "none";
}

const API_URL = window.APP_CONFIG.API_URL;

const urlParams = new URLSearchParams(window.location.search);
const userId = urlParams.get("id");

if (!userId) {
  alert("Hi√°nyz√≥ azonos√≠t√≥!");
}

/* ===== ADATOK ===== */
const cardsData = [
  { id: "alvas", label: "Alv√°s", emoji: "üò¥" },
  { id: "kave", label: "Nyugodt k√°v√©", emoji: "‚òï" },
  { id: "zuhany", label: "Hossz√∫ zuhany", emoji: "üöø" },
  { id: "sorozat", label: "Sorozatn√©z√©s", emoji: "üì∫" },
  { id: "randi", label: "Randiz√°s", emoji: "üíë" },
  { id: "csend", label: "Csend", emoji: "ü§´" },
  { id: "rend", label: "Rend √©s tisztas√°g", emoji: "üßº" },
  { id: "enido", label: "√ânid≈ë", emoji: "üéÆ" },
  { id: "telefon", label: "Telefon nyugodtan", emoji: "üì±" },
  { id: "melegkaja", label: "Meleg √©tel", emoji: "üçΩÔ∏è" },
  { id: "ataludt", label: "√Åtaludt √©jszaka", emoji: "üõå" },
  { id: "zene", label: "Zenehallgat√°s", emoji: "üéµ" },
  { id: "mosas", label: "Mos√°s utol√©r√©se", emoji: "üß∫" },
  { id: "gondolat", label: "Egybef√ºgg≈ë gondolat", emoji: "üß†" },
  { id: "nyugodteste", label: "Nyugodt este", emoji: "üïØÔ∏è" },
  { id: "sport", label: "Sportol√°s", emoji: "üèÉ‚Äç‚ôÇÔ∏è" }
];

/* ===== √ÅLLAPOT ===== */
let voteCounts = {};
let voting = false;
let selectedOptions = new Set();
const cardMap = {};

const loadingEl = document.getElementById("loading");

function showLoading(text = "‚è≥ Szavazatok bet√∂lt√©se‚Ä¶") {
  loadingEl.innerText = text;
  loadingEl.style.display = "block";
}

function hideLoading() {
  loadingEl.style.display = "none";
}

/* ===== CSEMP√âK L√âTREHOZ√ÅSA (EGYSZER) ===== */
function buildCards() {
  const container = document.getElementById("cards");

  cardsData.forEach(c => {
    const card = document.createElement("div");
    card.className = "card";

    card.innerHTML = `
      <div class="emoji">${c.emoji}</div>
      <div class="label">${c.label}</div>
      <div class="result">Szavazat: 0 db</div>
    `;

    card.onclick = () => vote(c.id);

    container.appendChild(card);
    cardMap[c.id] = card;
  });
}

/* ===== UI FRISS√çT√âS ===== */
function updateUI() {
  cardsData.forEach(c => {
    const card = cardMap[c.id];
    if (!card) return;

    const count = voteCounts[c.id] || 0;

    card.querySelector(".result").innerText =
      `Szavazat: ${count} db`;

    card.classList.remove("selected");

if (selectedOptions.has(c.id)) {
  card.classList.add("selected");
}

  });
}


/* ===== SZAVAZ√ÅS ===== */
async function vote(optionId) {
  if (voting || selectedOptions.has(optionId)) return;

  voting = true;
  cardsContainer.classList.add("disabled");
  showModal("‚è≥ Szavazat feldolgoz√°sa‚Ä¶");

  selectedOptions.add(optionId);
  localStorage.setItem(
    "selectedVotes_" + userId,
    JSON.stringify([...selectedOptions])
  );

  voteCounts[optionId] = (voteCounts[optionId] || 0) + 1;
  updateUI();

  try {
    await fetch(API_URL, {
      method: "POST",
      body: new URLSearchParams({
        id: userId,
        vote: optionId
      })
    });

    showModal("üîÑ Szavazatok friss√≠t√©se‚Ä¶");

    await loadCounts();
    updateUI();

  } catch (err) {
    alert("Hiba t√∂rt√©nt, pr√≥b√°ld √∫jra!");
  } finally {
    voting = false;
    cardsContainer.classList.remove("disabled");
    hideModal();
  }
}


/* ===== ADAT BET√ñLT√âS ===== */

async function loadCounts() {
  try {
    const res = await fetch(API_URL + "?mode=counts");
    const data = await res.json();
    if (data && !data.error) {
      voteCounts = data;
    }
  } catch (err) {
    console.error("Counts load error:", err);
  }
}


/* ===== IND√çT√ÅS ===== */
async function loadAll() {
  const saved = localStorage.getItem("selectedVotes_" + userId);
  if (saved) {
    selectedOptions = new Set(JSON.parse(saved));
  }

  showLoading();
  await loadCounts();
  updateUI();
  hideLoading();
}


buildCards();
loadAll();

  document.getElementById("nextBtn").onclick = () => {
  if (!userId) {
    alert("Hi√°nyz√≥ azonos√≠t√≥!");
    return;
  }

  window.location.href = `page4.html?id=${encodeURIComponent(userId)}`;
};


</script>

</body>
</html>
